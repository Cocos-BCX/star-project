{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\SDK\\bcx/assets\\SDK\\bcx\\bcxAdapter.js"],"names":["require","_configParams","ws_node_list","url","name","networks","core_asset","chain_id","faucetUrl","auto_reconnect","worker","real_sub","check_cached_nodes_data","BCXAdpater","cc","Class","start","initSDK","callback","contractName","window","BcxWeb","bcl","console","log","self","BCX","Cocosjs","plugins","CocosBCX","cocos","connect","then","connected","checkWindowBcx","is_success","cocosBcx","catch","e","JSON","stringify","check_count","sdk_intervral","setInterval","clearInterval","login","getAccountInfo","res","account_name","getBalanceByAccount","account","queryAccountBalances","assetId","info","code","data","COCOS","sendWinCocos","stars","callContractFunction","nameOrId","functionName","valueList","sendNhAsset","nhAssetID","bcxAdapter","module","exports"],"mappings":"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","file":"bcxAdapter.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\SDK\\bcx","sourcesContent":["\n\n\n// import BCX from 'bcx.min.js' \nrequire('./core.min')\n\nrequire('./plugins.min')\n\n//cocos配置\nvar _configParams = {\n    ws_node_list: [{\n        url: \"ws://39.106.126.54:8049\",\n        name: \"COCOS3.0节点2\"\n    }],\n    networks: [{\n        core_asset: \"COCOS\",\n        chain_id: '7d89b84f22af0b150780a2b121aa6c715b19261c8b7fe0fda3a564574ed7d3e9'\n    }],\n    faucetUrl: 'http://47.93.62.96:8041',\n    auto_reconnect: true,\n    worker: false,\n    real_sub: true,\n    check_cached_nodes_data: true,\n};\n\n\n\nlet BCXAdpater = cc.Class({\n    // onLoad () {},\n\n    start () {\n        //console.info(\"window=1=\",window.BcxWeb);\n    },\n\n    initSDK (callback) {\n          this.contractName = \"contract.starproject\";         //合约名称\n            if (window.BcxWeb) {\n                this.bcl =  window.BcxWeb;\n                console.log(\"===bcl---\")\n                if (callback) {\n                    callback(true);\n                }\n            }else{\n                console.log(\"===bcl--cocos-\")\n                let self = this\n                self.bcl = new BCX(_configParams);\n                Cocosjs.plugins(new CocosBCX())\n                //connect pc-plugin between sdk\n                Cocosjs.cocos.connect('My-App').then(connected => {\n                    console.log(\"connected==\"+connected)\n                    if (!connected) {\n                        //检测一下注入\n                        self.checkWindowBcx(function(is_success){\n                            console.log(\"is_success==\",is_success)\n                            if(is_success){\n                                if (callback) {\n                                    console.log(\"is_success==222\")\n                                    callback(true)\n                                }\n                            }else{\n                                console.log(\"no_cocos_pay\")\n                                callback(false)\n                            }\n                        })\n                        return false\n                    }\n    \n                    //此时走的是coocspay客户端\n                    const cocos = Cocosjs.cocos\n                    self.bcl = cocos.cocosBcx(self.bcl);\n                    if(self.bcl){\n                        if (callback) {\n                            callback(true);\n                        }  \n                    }else{\n                        if (callback) {\n                            callback(null);\n                        }\n                    }\n                }).catch(function(e){\n                    console.log(\"connect error---\"+JSON.stringify(e))\n                })\n    \n            }\n    },\n\n\n    checkWindowBcx(callback){\n        //目前进来的时候可能还没有吧bcx挂在window 需要个定时器\n        let check_count = 0\n        let self = this\n        let sdk_intervral = setInterval(function(){\n            console.log(\"checkWindowBcx\",window.BcxWeb)\n            if (window.BcxWeb){\n                self.bcl = window.BcxWeb\n                if(callback){\n                    callback(true)\n                }\n                clearInterval(sdk_intervral);\n            }\n           \n            if(check_count>=3){\n                clearInterval(sdk_intervral);\n                if(callback){\n                    callback(false)\n                }\n            }\n            check_count = check_count + 1\n\n        }, 1000);\n    },\n\n    login(callback){\n        if(this.bcl){\n            try{\n                console.log(\"login===adada=\")\n                this.bcl.getAccountInfo().then(res => {\n                    console.log(\"res.account_name==\"+res.account_name)\n                    this.bcl.account_name = res.account_name           \n                    if (callback) {\n                        callback(res);\n                    }\n                })\n            }catch(e){\n                console.log(\"login==e====\"+e)\n                console.log(\"his.bcl.account_name===\"+this.bcl.account_name)\n                if(this.bcl.account_name){\n                    if (callback) {\n                        callback(this.bcl.account_name);\n                    }\n                }\n            }\n            \n        }\n    },\n\n    getBalanceByAccount (account, callback) {\n        this.bcl.queryAccountBalances({\n            assetId:'COCOS',\n            account: account,\n        \n        }).then(function(res){\n            console.info('getBalanceByAccount==',res);\n\n            if (res.code === -25 || res.code === 125) {\n                //表示还没有这种代币，先给与赋值为0\n                res.code = 1;\n                res.data.COCOS = 0;\n                if (callback) {\n                    callback(res);\n                }\n            }\n\n            if (res.code === 1) {\n                if (callback) {\n                    callback(res);\n                }\n            } else if (callback) {\n                callback(res);\n            }   \n        });\n    },\n\n    sendWinCocos(account,stars,callback) {\n        this.bcl.callContractFunction({\n            nameOrId: this.contractName,\n            functionName: 'sendstar',\n            valueList:[account, stars],////\n           \n        }).then(function(res){\n            console.info(\"draw res=\",res);\n\n            if (res.code === 1) {\n                callback(res);\n            } else {\n                callback(res);\n            }\n        }).catch(function(e){\n            console.info(\"sendWinCocos error=\",JSON.stringify(e));\n        });\n    },\n\n    sendNhAsset(account,nhAssetID,callback) {\n        this.bcl.callContractFunction({\n            nameOrId: this.contractName,\n            functionName: 'transfer_nht_from_owner',\n            valueList:[account, nhAssetID],////\n           \n        }).then(function(res){\n            console.info(\"draw res=\",res);\n\n            if (res.code === 1) {\n                callback(res);\n            } else {\n                callback(res);\n            }\n        }).catch(function(e){\n            console.info(\"sendNhAsset error=\",JSON.stringify(e));\n        });\n    },\n\n});\n\nlet bcxAdapter = new BCXAdpater();\nbcxAdapter.start();\nmodule.exports = bcxAdapter;"]}